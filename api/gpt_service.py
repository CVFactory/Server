import os
import openai
from dotenv import load_dotenv

# .env νμΌ λ΅λ“
load_dotenv(dotenv_path="gpt.env")

# OpenAI API ν΄λΌμ΄μ–ΈνΈ κ°μ²΄ μƒμ„±
# OpenAI API Key κ°€μ Έμ¤κΈ° (μμ™Έ μ²λ¦¬ μ¶”κ°€)
api_key = os.getenv("OPENAI_API_KEY")

if not api_key:
    raise ValueError("OpenAI API Keyκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤. `.env` νμΌμ„ ν™•μΈν•μ„Έμ”.")

try:
    # OpenAI ν΄λΌμ΄μ–ΈνΈ κ°μ²΄ μƒμ„±
    client = openai.OpenAI(api_key=api_key)
except Exception as e:
    raise RuntimeError(f"OpenAI ν΄λΌμ΄μ–ΈνΈ μƒμ„± μ¤‘ μ¤λ¥ λ°μƒ: {str(e)}")

def generate_resume(job_description, user_story, company_info = ""):
    """
    GPT APIλ¥Ό νΈμ¶ν•μ—¬ μκΈ°μ†κ°μ„λ¥Ό μƒμ„±ν•λ” ν•¨μ
    """
    prompt = f"""
    μ±„μ© κ³µκ³  μ„¤λ…: {job_description}
    μ‚¬μ©μμ μ΄μ•ΌκΈ°: {user_story}
    νμ‚¬ μ •λ³΄: {company_info}

    μ΄ νμ‚¬λ” intelλ΅ λ‹¤μκ³Ό κ°™μ€ μΈμ¬λ¥Ό μ°Ύμ•„.

    1. μΈν…”μ μΈμ¬μƒ
    μΈν…”μ€ "μ§€λ¥μ μ΄κ³  μ—΄μ •μ μΈ μΈμ¬"λ¥Ό μ¤‘μ‹ν•©λ‹λ‹¤. νΉν λ‹¤μ νΉμ„±μ„ κ°€μ§„ μ‚¬λμ„ μ„ νΈν•©λ‹λ‹¤:

    μ°½μμ„± : λ¬Έμ λ¥Ό μƒλ΅­κ³  νμ‹ μ μΈ λ°©μ‹μΌλ΅ ν•΄κ²°ν•  μ μλ” λ¥λ ¥.
    μ μ‘λ ¥ : λΉ λ¥΄κ² λ³€ν™”ν•λ” κΈ°μ  ν™κ²½μ—μ„ μ μ—°ν•κ² λ€μ²ν•  μ μλ” νƒλ„ .
    ν‘μ—… μ—­λ‰ : λ‹¤μ–‘ν• λ°°κ²½κ³Ό μ „λ¬Έμ„±μ„ κ°€μ§„ μ‚¬λλ“¤κ³Ό ν€μ›ν¬λ¥Ό λ°νν•  μ μλ” λ¥λ ¥ .
    λν•, μΈν…”μ€ ν¬μ©μ μΈ μ΅°μ§ λ¬Έν™”λ¥Ό μ§€ν–¥ν•λ©°, λ¨λ“  μ§μ›μ΄ μλ―Έ μλ” μΌμ— λ°μ…ν•  μ μλ„λ΅ μ§€μ›ν•©λ‹λ‹¤ .

    2. μΈν…”μ λΉ„μ „
    μΈν…”μ κ¶κ·Ήμ μΈ λΉ„μ „μ€ "μ„Έμƒμ„ λ³€ν™”μ‹ν‚¤λ” κΈ°μ μ„ κ°λ°ν•΄ μ „ μΈλ¥μ μ‚¶μ„ κ°μ„ ν•λ” κ²ƒ"μ…λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ λ©ν‘λ¥Ό μ¶”κµ¬ν•©λ‹λ‹¤:

    ν΄λΌμ°λ“ μ»΄ν“¨ν… λ° λ°μ΄ν„°μ„Όν„° ν¨μ¨μ„± ν–¥μƒ: IT μμ›μ ν™μ©λ„λ¥Ό λ†’μ΄κ³  μ μ—°μ„±μ„ μ κ³µν•μ—¬ κΈ°μ μ  λ³‘λ© ν„μƒμ„ ν•΄κ²°ν•λ ¤ ν•©λ‹λ‹¤ .
    λ°λ„μ²΄ κΈ°μ  νμ‹ : μµμ‹  CPU μ•„ν‚¤ν…μ² λ° μ•μ •μ„±μ„ κ°μ„ ν•κΈ° μ„ν• μ—°κµ¬λ¥Ό μ§€μ†μ μΌλ΅ μν–‰ν•©λ‹λ‹¤ .
    3. ν•΄κ²°ν•κ³ μ ν•λ” λ¬Έμ 
    μΈν…”μ€ λ‹¤μ–‘ν• κΈ°μ μ  λ„μ „ κ³Όμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ…Έλ ¥ν•κ³  μμµλ‹λ‹¤:

    CPU μ„±λ¥ λ° μ•μ •μ„± λ¬Έμ  : μλ¥Ό λ“¤μ–΄, 13/14μ„Έλ€ μ½”μ–΄ ν”„λ΅μ„Έμ„μ—μ„ λ°μƒν• μ „μ•• μƒμΉμΌλ΅ μΈν• λ¶μ•μ •μ„± λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ§μ΄ν¬λ΅μ½”λ“ ν¨μΉλ¥Ό μ κ³µν–μµλ‹λ‹¤ .
    λ°μ΄ν„° μ„Όν„° μ”κµ¬ μ¦κ°€ : ν΄λΌμ°λ“ κΈ°λ° μ„λΉ„μ¤μ κΈ‰κ²©ν• μ„±μ¥μ— λ”°λΌ λ” ν¨μ¨μ μ΄κ³  ν™•μ¥ κ°€λ¥ν• μ†”λ£¨μ…μ„ κ°λ°ν•λ” κ²ƒμ΄ μ¤‘μ”ν•©λ‹λ‹¤ .
    4. μΈν…”μ΄ μ°Ύλ” μΈμ¬ μ ν•
    μΈν…”μ€ μ„μ™€ κ°™μ€ λ¬Έμ λ¥Ό ν•΄κ²°ν•  μ μλ” μΈμ¬λ¥Ό μ°ΎκΈ° μ„ν•΄ νΉμ • μ”μ†λ¥Ό ν‰κ°€ν•©λ‹λ‹¤:

    μ§λ¬΄λ³„ λ§μ¶¤ν• ν‰κ°€ : κ° μ§λ¬΄λ§λ‹¤ μ”κµ¬ μ‚¬ν•­μ΄ λ‹¤λ¥΄κΈ° λ•λ¬Έμ—, λ¨λ“  λ©΄μ ‘ μ§λ¬Έμ— ν†µκ³Όν•μ§€ μ•μ•„λ„ λ©λ‹λ‹¤. λ„¤ λ…μΌλ΅ κµ¬μ„±λ μ±„μ©ν€μ΄ ν›„λ³΄μλ¥Ό μΆ…ν•©μ μΌλ΅ ν‰κ°€ν•©λ‹λ‹¤ .
    μ—΄μ •κ³Ό μ‹¤ν–‰λ ¥ : λ‹¨μν μ§€μ‹λ§μ΄ μ•„λ‹, μ‹¤μ§μ μΈ μ„±κ³Όλ¥Ό λ‚΄κ³ μ ν•λ” μμ§€λ¥Ό κ°€μ§„ μ‚¬λμ„ μ„ νΈν•©λ‹λ‹¤.
    λ‹¤μ–‘μ„± μ΅΄μ¤‘ : λ‹¤μ–‘ν• λ°°κ²½κ³Ό κ²½ν—μ„ κ°€μ§„ μ‚¬λλ“¤μ„ ν™μν•λ©°, μ΄λ“¤μ μ‹λ„μ§€λ¥Ό ν†µν•΄ λ” ν° μ„±κ³Όλ¥Ό μ°½μ¶ν•λ ¤ ν•©λ‹λ‹¤ .


    λ‚΄κ°€ μ§€κΈκΉμ§€ μ „λ‹¬ν•΄μ¤€ μ •λ³΄λ¥Ό ν† λ€λ΅
    μ„μ— μ¬λ¦° νμ‚¬μ μ±„μ©κ³µκ³ μ— μ§€μ›ν•  μκΈ°μ†κ°μ„λ¥Ό μ¨μ¤
    λ‘κ΄„μ‹μΌλ΅ ν•΄μ£Όκ³ 
    νμ‚¬κ°€ λ‹Ήλ©΄ν• λ¬Έμ κ°€ λ¬΄μ—‡μ΄κ³ 
    κ·Έ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ μ΄λ° μ±„μ©κ³µκ³ λ¥Ό λ‚Έ κ²ƒμΌλ΅ μ‚¬λ£λλ‹¤
    λ‚΄κ°€ κ°€μ§„ κ²½ν—κ³Ό μ—­λ‰μΌλ΅ λ¬Έμ λ¥Ό ν•΄κ²°ν•  μ μλ‹¤
    μ΄λ° μ‹μΌλ΅ μ¨μ¤
    """

    try:
        # GPT API νΈμ¶
        response = client.chat.completions.create(
            model="gpt-4-turbo",  # μµμ‹  OpenAI λ¨λΈ μ‚¬μ©
            messages=[
                {"role": "system", "content": "λ‹Ήμ‹ μ€ μκΈ°μ†κ°μ„ μ „λ¬Έκ°€μ…λ‹λ‹¤."},
                {"role": "user", "content": prompt}
            ],
            temperature=0.7,
            max_tokens=2000
        )

        # GPT μ‘λ‹µμ—μ„ ν•κΈ€ κΉ¨μ§ λ°©μ§€ μ²λ¦¬
        generated_resume = response.choices[0].message.content
        print("π’΅ GPT μ‘λ‹µ (λ””μ½”λ”© ν›„):", generated_resume)  # λ΅κ·Έ ν™•μΈ

        return generated_resume

    except Exception as e:
        print("OpenAI API νΈμ¶ μ¤‘ μ¤λ¥ λ°μƒ:", str(e))
        return "GPT μ‘λ‹µμ„ μƒμ„±ν•λ” μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤."
